(window.webpackJsonp=window.webpackJsonp||[]).push([[81],{534:function(t,e,l){"use strict";l.r(e);var s=l(110),i={name:"ListQuickEdit",data(){return{dialog:!1,attrs:{...this.$attrs},modelBkp:null,model:null,isNew:!1,currentLang:null,errors:null,on:{click:t=>{t.preventDefault(),t.stopPropagation(),this.dialog=!this.dialog}}}},props:{value:{type:Boolean},editFields:{type:Array,default:()=>[]},languages:{type:Array,default(){var t,e;return(null===(t=this.$mapo.$options)||void 0===t||null===(e=t.content)||void 0===e?void 0:e.languages)||[]}},lookup:{type:String,default:"id"},crud:{type:Object,required:!0},dialogProps:{type:Object,required:!1,default:()=>({width:600,scrollable:!0})},offline:Boolean},watch:{value(t){this.dialog=t},dialog(t){this.$emit("input",t),this.$emit(t?"open":"close"),t||this.close()}},computed:{langs(){var t,e;return(null===(t=this.model)||void 0===t||null===(e=t.lang_info)||void 0===e?void 0:e.site_languages.map(t=>t.id))||this.languages||[]},loading(){return!this.isNew&&!Object.keys(this.model||{}).length},nonFieldErrors(){var t;return(null===(t=this.errors)||void 0===t?void 0:t.non_field_errors)||[]},slotBindings(){return{model:this.model,currentLang:this.currentLang,crud:this.crud,isNew:this.isNew,langs:this.langs,loading:this.loading,form:this.$refs.form,save:this.save,close:this.close}}},methods:{async open(t){var e;return this.isNew=!t,this.modelBkp=await this.fetchItem(t),this.model=Object(s.deepClone)(this.modelBkp),this.dialog=!0,null===(e=this.$refs.form)||void 0===e||e.resetValidation(),new Promise((t,e)=>{this.resolve=t,this.reject=e})},async save(){var t;if(null!==(t=this.$refs.form)&&void 0!==t&&t.validate())return await(this.isNew?this.apiCreate():this.apiEdit())},close(t){var e;this.errors=null,this.currentLang=null,null===(e=this.$refs.form)||void 0===e||e.resetValidation(),this.resolve&&this.resolve(t),this.dialog=!1},async fetchItem(t){return!this.offline&&t&&t[this.lookup]?await this.crud.detail(t[this.lookup]):t},apiEdit(){if(!this.offline)return this.crud.partialUpdate(this.modelBkp[this.lookup],this.model).then(t=>this.close(t)).catch(this.handleError);this.close(this.model)},apiCreate(){return this.offline?this.close(this.model):this.crud.create(this.model).then(t=>this.close(t)).catch(this.handleError)},handleError(t){var e,l;const s=400==t.response.status;this.errors=s&&t.response.data||null,this.$mapo.$snack.open({message:s?this.$t("mapo.listQuickEdit.badInput"):(null===(e=t.response)||void 0===e||null===(l=e.data)||void 0===l?void 0:l.detail)||this.$t("mapo.genericError"),color:"error"})}}},n=l(1),o=Object(n.a)(i,(function(){var t=this,e=t._self._c;return e("div",[t._t("activator",null,null,{on:t.on,attrs:t.attrs}),t._v(" "),e("v-dialog",t._b({model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},"v-dialog",t.dialogProps,!1),[e("v-card",t._b({},"v-card",t.$attrs,!1),[e("v-card-title",{staticClass:"pa-0 mb-3"},[e("div",{staticStyle:{"max-width":"calc(100% - 40px)"}},[t._t("lang",(function(){return[t.langs.length>1?e("DetailLangSwitch",{attrs:{langs:t.langs,errors:t.errors},model:{value:t.currentLang,callback:function(e){t.currentLang=e},expression:"currentLang"}}):t._e()]}),null,t.slotBindings)],2),t._v(" "),e("v-spacer"),t._v(" "),t._t("title",(function(){return[e("v-hover",{scopedSlots:t._u([{key:"default",fn:function({hover:l}){return[e("v-icon",{staticClass:"mr-4",class:{"mt-4":!t.langs.length},on:{click:function(e){l&&t.close()}}},[t._v(t._s(l?"mdi-close":t.isNew?"mdi-plus-circle-outline":"mdi-pencil-outline"))])]}}])})]}),null,t.slotBindings)],2),t._v(" "),e("v-card-text",{staticClass:"pa-0 px-2"},[e("v-container",[t.model?e("v-form",{ref:"form"},[t._t("body.top",null,null,t.slotBindings),t._v(" "),t._t("body",(function(){return[e("Form",{attrs:{currentLang:t.currentLang,languages:t.langs,errors:t.errors,fields:t.editFields,modeSlotBindings:t.slotBindings},scopedSlots:t._u([t._l(t.$scopedSlots,(function(e,l){return{key:l,fn:function(e){return[t._t(l,null,null,e)]}}}))],null,!0),model:{value:t.model,callback:function(e){t.model=e},expression:"model"}},[t._l(t.$slots,(function(l,s){return e("template",{slot:s},[t._t(s)],2)}))],2)]}),null,t.slotBindings),t._v(" "),t._t("body.bottom",null,null,t.slotBindings)],2):t._e()],1)],1),t._v(" "),e("v-card-actions",[t.nonFieldErrors.length?e("v-messages",{attrs:{color:"error"},model:{value:t.nonFieldErrors,callback:function(e){t.nonFieldErrors=e},expression:"nonFieldErrors"}}):t._e(),t._v(" "),t._t("actions",(function(){return[e("v-spacer"),t._v(" "),e("v-btn",{attrs:{text:""},on:{click:function(e){return t.close()}}},[t._v(t._s(t.$t("mapo.cancel")))]),t._v(" "),e("v-btn",{attrs:{text:""},on:{click:t.save}},[t._v(t._s(t.$t("mapo.save")))])]}),null,t.slotBindings)],2)],1)],1)],2)}),[],!1,null,null,null);e.default=o.exports}}]);