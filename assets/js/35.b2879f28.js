(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{382:function(t,e,i){},446:function(t,e,i){"use strict";i(382)},447:function(t,e){},526:function(t,e,i){"use strict";i.r(e);i(20);var n=i(110),s={name:"Detail",data(){return{model:{},modelLanguages:[],currentLang:this.lang,errors:null,buttonClicked:null}},props:{value:{type:Object,required:!1},lang:{type:String,required:!1},fields:{type:Object|Array,required:!0},usePatch:{type:Boolean,default(){var t,e;return(null===(t=this.$mapo.$options)||void 0===t||null===(e=t.content)||void 0===e?void 0:e.usePatch)||!1}},languages:{type:Array,default(){var t,e;return(null===(t=this.$mapo.$options)||void 0===t||null===(e=t.content)||void 0===e?void 0:e.languages)||[]}},forceLanguages:{type:Boolean,default(){var t,e;return(null===(t=this.$mapo.$options)||void 0===t||null===(e=t.content)||void 0===e?void 0:e.forceLanguages)||!1}},endpoint:{type:String,default:null},sidenavCol:{type:Number|String,default:"4",validator:function(t){return-1!==[...Array(12).keys()].indexOf(+t)}},identifier:{type:String|Number,default:"new"},modelName:String,sticky:{type:Boolean,default:!0},multipart:{type:String,default:"auto",validator:function(t){return-1!==["auto","force","disable"].indexOf(t)}},previewField:{type:String,required:!1},readonly:Boolean},methods:{back(){var t,e;"login"==(null===(t=this.$nuxt.context)||void 0===t||null===(e=t.from)||void 0===e?void 0:e.name)?this.$router.go(-3):this.$router.back()},saveItem(t=!1){var e;this.buttonClicked=t?"saveAndBackBtn":"saveBtn",this.errors=null,null===(e=this.$refs.form)||void 0===e||e.resetValidation(),this.apiSendPayload().then(e=>{Object.assign(this.model,e),this.modelBkp=Object(n.deepClone)(this.model),this.$mapo.$snack.open({message:this.isNew?this.$t("mapo.createSuccess"):this.$t("mapo.saveSuccess"),color:"success"}),this.isNew&&this.$router.replace({params:{detail:e.id}}),t&&this.back()}).catch(t=>{var e,i;this.errors=400==t.response.status&&t.response.data||null,this.$mapo.$snack.open({message:(null===(e=t.response)||void 0===e||null===(i=e.data)||void 0===i?void 0:i.detail)||this.$t("mapo.genericError"),color:"error"})}).finally(()=>{this.buttonClicked=null})},deleteItem(){this.$mapo.$confirm.open({title:this.$t("mapo.delete"),question:this.$t("mapo.confirmDelete"),approveButton:{text:this.$t("mapo.delete"),attrs:{color:"red",text:!0}}}).then(t=>{t&&(this.buttonClicked="deleteBtn",this.crud.delete(this.identifier).then(()=>{this.unsetRouterGuard(),this.back()}).catch(t=>{var e,i;return this.$mapo.$snack.open({message:(null===(e=t.response)||void 0===e||null===(i=e.data)||void 0===i?void 0:i.detail)||this.$t("mapo.genericError"),color:"error"})}).finally(()=>{this.buttonClicked=null}))})},async checkUnsavedHook(t,e,i){t.name!==e.name&&this.hasDiff?this.$mapo.$confirm.open({title:this.$t("mapo.unsavedData"),question:this.$t("mapo.confirmLeaveChanges"),approveButton:{text:this.$t("mapo.confirm"),attrs:{text:!0}}}).then(i):i()},setRouterGuard(){var t;this.$router.beforeHooks.push(this.checkUnsavedHook),null===(t=window)||void 0===t||t.addEventListener("beforeunload",this.preventWindowClose)},preventWindowClose(t){const e=this.$t("mapo.confirmLeaveChanges");if(this.hasDiff)return t.returnValue=e,e},unsetRouterGuard(){var t;null===(t=window)||void 0===t||t.removeEventListener("beforeunload",this.preventWindowClose),this.$router.beforeHooks=this.$router.beforeHooks.filter(t=>t!=this.checkUnsavedHook)}},watch:{currentLang(t){this.$emit("update:lang",t)},model(t){this.$emit("input",t)},lang(t){t&&this.langs.includes(t)&&(this.currentLang=t)},value(t){t&&(this.model=t)}},computed:{canGoBack(){var t,e,i;return"undefined"==typeof window||("login"!==(null===(t=this.$nuxt)||void 0===t||null===(e=t.context)||void 0===e||null===(i=e.from)||void 0===i?void 0:i.name)&&window.history.length>1||window.history.length>3)},crud(){return this.$mapo.$api.crud(this.endpoint)},apiSendPayload(){let t,e;return this.model.id?this.usePatch?(t=this.crud.partialUpdate,e=[this.model.id,this.modelDiff,{},{multipart:this.multipart}]):(t=this.crud.update,e=[this.model.id,this.model,{},{multipart:this.multipart}]):(t=this.crud.create,e=[this.model,{},{multipart:this.multipart}]),async()=>t(...e)},isReadonly(){return this.readonly?this.readonly:this.$mapo.$auth.routeMiddlewares.includes("permissions")?!this.$mapo.$auth.user.permissions.includes(this.isNew?"add":"change"):!!this.buttonClicked},canDelete(){return!this.readonly&&(!this.$mapo.$auth.routeMiddlewares.includes("permissions")||this.$mapo.$auth.user.permissions.includes("delete"))},mainFields(){return this.fields instanceof Array?this.fields:this.fields.main||[]},sideFields(){return this.fields instanceof Object&&this.fields.sidenav||[]},isNew(){return this.identifier&&"new"==this.identifier},loading(){return"new"!==this.identifier&&!Object.keys(this.model).length},langs(){return!this.forceLanguages&&(this.modelLanguages||[]).length?this.modelLanguages:this.languages},slotBindings(){return{model:this.model,errors:this.errors,currentLang:this.currentLang,crud:this.crud,isNew:this.isNew,langs:this.langs,loading:this.loading,form:this.$refs.form,saveItem:this.saveItem,deleteItem:this.deleteItem}},stickySide(){return this.sticky?{position:"sticky",top:"60px"}:{}},modelDiff(){return Object(n.diffObjs)(this.modelBkp,this.model)||{}},hasDiff(){return!!(this.modelDiff&&Object.keys(this.modelDiff).length>0)},previewUrl(){return this.previewField?this.model[this.previewField]:null}},async mounted(){if(this.identifier&&"new"!==this.identifier)try{var t,e;this.model=await this.crud.detail(this.identifier),this.modelLanguages=null===(t=this.model)||void 0===t||null===(e=t.lang_info)||void 0===e?void 0:e.site_languages.map(t=>t.id)}catch(t){var i;this.$nuxt.error({statusCode:t.response.status,message:(null===(i=t.response.data)||void 0===i?void 0:i.detail)||this.$t("mapo.genericError")})}else if(this.value){var s,o;this.model=this.value,this.modelLanguages=null===(s=this.model)||void 0===s||null===(o=s.lang_info)||void 0===o?void 0:o.site_languages.map(t=>t.id)}this.modelBkp=Object(n.deepClone)(this.model),this.setRouterGuard()},destroyed(){this.unsetRouterGuard()}},o=(i(446),i(1)),l=i(447),a=i.n(l),r=Object(o.a)(s,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"mapo-detail--wrapper"},[t.loading?e("div",{staticClass:"mapo-detail--loader"},[e("v-progress-linear",{attrs:{color:"primary",indeterminate:"",absolute:""}}),t._v(" "),e("span",{staticClass:"detail-component-loading"},[e("v-icon",{attrs:{size:"30"}},[t._v("mdi-timer-sand")]),t._v("\n      "+t._s(t.$t("mapo.fetchingData"))+"\n    ")],1)],1):e("div",{staticClass:"mapo-detail--loaded"},[t._t("title",(function(){return[e("h1",{staticClass:"mapo-detail--title"},[t._v("\n        "+t._s(t.isNew?t.$t("mapo.create"):t.$t("mapo.edit"))+" "+t._s(t.modelName)+"\n      ")])]}),null,t.slotBindings),t._v(" "),e("v-form",{ref:"form",staticClass:"mapo-detail--form"},[e("v-row",[e("v-col",{staticClass:"mapo-detail--main",attrs:{cols:"12",md:12-t.sidenavCol}},[t._t("body.top",null,null,t.slotBindings),t._v(" "),t._t("body.lang",(function(){return[t.langs&&t.langs.length?e("DetailLangSwitch",{directives:[{name:"show",rawName:"v-show",value:t.langs.length>1,expression:"langs.length > 1"}],staticClass:"mapo-detail--language-tabs",attrs:{langs:t.langs,errors:t.errors},model:{value:t.currentLang,callback:function(e){t.currentLang=e},expression:"currentLang"}}):t._e()]}),null,t.slotBindings),t._v(" "),t._t("body.top.underlang",null,null,t.slotBindings),t._v(" "),t._t("body",(function(){return[e("Form",{attrs:{currentLang:t.currentLang,languages:t.langs,errors:t.errors,fields:t.mainFields,moreSlotBindings:t.slotBindings,readonly:t.isReadonly},scopedSlots:t._u([t._l(t.$scopedSlots,(function(e,i){return{key:i,fn:function(e){return[t._t(i,null,null,e)]}}}))],null,!0),model:{value:t.model,callback:function(e){t.model=e},expression:"model"}},[t._l(t.$slots,(function(i,n){return e("template",{slot:n},[t._t(n)],2)}))],2)]}),null,t.slotBindings),t._v(" "),t._t("body.bottom",null,null,t.slotBindings)],2),t._v(" "),e("v-col",{staticClass:"mapo-detail--sidenav",attrs:{cols:"12",md:t.sidenavCol}},[e("div",{staticClass:"mapo-detail--sidenav-col",style:t.stickySide},[t._t("side.buttons.top",null,null,t.slotBindings),t._v(" "),t._t("side.buttons",(function(){return[e("div",{staticClass:"mapo-detail--buttons"},[t._t("button.save",(function(){return[e("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.canGoBack,expression:"canGoBack"}],attrs:{loading:"saveAndBackBtn"==t.buttonClicked,disabled:t.isReadonly,tile:"",block:""},on:{click:function(e){return t.saveItem(!0)}}},[t._v(t._s(t.isNew?t.$t("mapo.create"):t.$t("mapo.save")))])]}),null,t.slotBindings),t._v(" "),t._t("button.savecontinue",(function(){return[e("v-btn",{attrs:{loading:"saveBtn"==t.buttonClicked,disabled:t.isReadonly,tile:"",block:""},on:{click:function(e){return t.saveItem(!1)}}},[t._v(t._s(t.isNew?t.$t("mapo.createContinue"):t.$t("mapo.saveContinue")))])]}),null,t.slotBindings),t._v(" "),t._t("button.back",(function(){return[e("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.canGoBack,expression:"canGoBack"}],attrs:{tile:"",block:""},on:{click:t.back}},[t._v(t._s(t.$t("mapo.back")))])]}),null,t.slotBindings),t._v(" "),t._t("button.delete",(function(){return[t.isNew?t._e():e("v-btn",{attrs:{color:"error",tile:"",block:"",disabled:!t.canDelete},on:{click:t.deleteItem}},[t._v(t._s(t.$t("mapo.delete")))])]}),{loading:"deleteBtn"==t.buttonClicked},t.slotBindings),t._v(" "),t._t("button.preview",(function(){return[t.previewUrl?e("PagePreview",{attrs:{pageUrl:t.previewUrl}}):t._e()]}),null,t.slotBindings)],2)]}),null,t.slotBindings),t._v(" "),t._t("side.top",null,null,t.slotBindings),t._v(" "),e("Form",{attrs:{currentLang:t.currentLang,languages:t.langs,errors:t.errors,fields:t.sideFields,moreSlotBindings:t.slotBindings,readonly:t.isReadonly},scopedSlots:t._u([t._l(t.$scopedSlots,(function(e,i){return{key:i,fn:function(e){return[t._t(i,null,null,e)]}}}))],null,!0),model:{value:t.model,callback:function(e){t.model=e},expression:"model"}},[t._l(t.$slots,(function(i,n){return e("template",{slot:n},[t._t(n)],2)}))],2),t._v(" "),t._t("side.bottom",null,null,t.slotBindings)],2)])],1)],1)],2)])}),[],!1,null,"1215152a",null);"function"==typeof a.a&&a()(r);e.default=r.exports}}]);