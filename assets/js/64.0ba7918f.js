(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{401:function(e,t,i){},469:function(e,t,i){"use strict";i(401)},549:function(e,t,i){"use strict";i.r(t);i(20);var s=i(30);var a={name:"MediaUploader",data:()=>({buffer:0,stream:!1,responses:[],mediaList:[],_mediaFileCrud:null}),computed:{...Object(s.c)("mapo/media",["parentFolder","folders"]),mediaFileCrud(){return this._mediaFileCrud=this._mediaFileCrud||this.$mapo.$api.crud("api/media"),this._mediaFileCrud},completed(){return`${this.responses.length}/${this.mediaList.length}`},folderOptions(){return[{text:this.parentFolder&&this.parentFolder.path||"/",value:this.parentFolder&&this.parentFolder.id||null},...this.folders.map(e=>({text:e.path,value:e.id}))]},progress(){return this.responses.length/this.mediaList.length*100},bufferProgress(){return this.buffer/this.mediaList.length*100}},methods:{isTooLarge({info:e}){const{type:t}=e;switch(t.split("/")[0]){case"image":return e.rawsize>1e6;case"video":return e.rawsize>1e8;default:return!1}},updateMediaList(e){this.mediaList=e,this.mediaList.forEach(e=>{e.info.title=e.info.title||e.info.name,e.info.alt_text=e.info.alt_text||e.info.name,e.info.description=e.info.description||e.info.name,e.info.folder=e.info.folder||this.parentFolder&&this.parentFolder.id||null}),this.responses=[],this.buffer=0,this.stream=!1},async updateAll(){this.stream=!0;for(const e of this.mediaList)await this.uploadMedia(Object.assign({file:e.blob},{title:e.info.title,alt_text:e.info.alt_text,description:e.info.description,folder:e.info.folder})).then(e=>this.responses.push(e)).catch(e=>{var t,i;this.$mapo.$snack.open({message:(null===(t=e.response)||void 0===t||null===(i=t.data)||void 0===i?void 0:i.detail)||this.$t("mapo.genericError"),color:"error"})});this.mediaList&&this.mediaList.length&&(this.$mapo.$snack.open({message:this.$t("mapo.mediaUploader.success",{numberFiles:this.responses.length||this.mediaList.length})}),this.$emit("Upload",this.responses.length&&this.responses||this.mediaList),this.$refs.closeButton.$el.click())},async uploadMedia(e){const t=this.$mapo.$api.multipart(e,["file"]),i={headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){this.buffer=Math.ceil(this.buffer)+e.loaded/e.total}.bind(this)};return await this.mediaFileCrud.create(t,i)}}},o=(i(469),i(1)),r=Object(o.a)(a,(function(){var e=this,t=e._self._c;return t("v-container",{staticClass:"container"},[t("drop-area",{attrs:{multiple:""},on:{change:function(t){return e.updateMediaList(t)}},scopedSlots:e._u([{key:"actions",fn:function({clearList:i}){return[e.mediaList&&e.mediaList.length?t("div",[t("v-btn",{attrs:{icon:""},on:{click:i}},[t("v-icon",{ref:"closeButton"},[e._v("mdi-close")])],1),e._v(" "),t("v-btn",{attrs:{icon:""},on:{click:e.updateAll}},[t("v-icon",[e._v("mdi-upload")])],1)],1):e._e()]}},{key:"list-item.content.after",fn:function({item:i}){return[e.isTooLarge(i)?t("v-chip",{attrs:{dense:"",color:"error"}},[e._v(e._s(e.$t("mapo.mediaUploader.tooLarge")))]):e._e()]}},{key:"editContent",fn:function({editedItem:i}){return[t("v-container",[t("v-row",[t("v-col",{attrs:{cols:"12"}},[t("v-select",{attrs:{items:e.folderOptions,label:e.$t("mapo.folder")},model:{value:i.folder,callback:function(t){e.$set(i,"folder",t)},expression:"editedItem.folder"}})],1),e._v(" "),t("v-col",{attrs:{cols:"12"}},[t("v-text-field",{attrs:{label:e.$t("titleTag")},model:{value:i.title,callback:function(t){e.$set(i,"title",t)},expression:"editedItem.title"}})],1),e._v(" "),t("v-col",{attrs:{cols:"12"}},[t("v-text-field",{attrs:{label:e.$t("mapo.description")},model:{value:i.description,callback:function(t){e.$set(i,"description",t)},expression:"editedItem.description"}})],1),e._v(" "),t("v-col",{attrs:{cols:"12"}},[t("v-text-field",{attrs:{label:e.$t("mapo.altTag")},model:{value:i.alt_text,callback:function(t){e.$set(i,"alt_text",t)},expression:"editedItem.alt_text"}})],1)],1)],1)]}}])}),e._v(" "),e.mediaList.length?t("div",{staticClass:"mt-3"},[t("p",{staticClass:"text-right mr-3 mb-2"},[e._v(e._s(e.bufferProgress>=100?e.$t("mapo.mediaUploader.optimizingFiles"):e.progress>0?e.$t("mapo.mediaUploader.uploadingFiles"):"")+" "+e._s(e.completed))]),e._v(" "),t("v-progress-linear",{attrs:{stream:e.stream,indeterminate:100==e.progress,value:e.progress,"buffer-value":e.bufferProgress}})],1):e._e()],1)}),[],!1,null,"dddab2fa",null);t.default=r.exports}}]);