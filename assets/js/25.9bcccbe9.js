(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{284:function(t,e){t.exports={nameSpacedSlots:function(t,e){return Object.keys(t).filter(t=>t.startsWith(e)).map(t=>t.replace(e,""))}}},288:function(t,e){t.exports={debounce:function(t,e,i){var s;return function(){var n=this,a=arguments,r=function(){s=null,i||t.apply(n,a)},o=i&&!s;clearTimeout(s),s=setTimeout(r,e),o&&t.apply(n,a)}},memoizedDebounce:function(t,e,i,s=(t=>JSON.stringify(t))){var n={};return function(){var a=this,r=arguments,o=s(arguments),l=function(){n[o]=null,i||t.apply(a,r)},c=i&&!n[o];clearTimeout(n[o]),n[o]=setTimeout(l,e),c&&t.apply(a,r)}}}},345:function(t,e,i){"use strict";var s=i(33),n=i(31),a=i(7),r=i(55),o=i(3),l=i(56),c=i(346),d=i(112),u=i(111),h=i(347),p=i(349),m=i(32),g=i(58),f=m("replace"),v=TypeError,b=a("".indexOf),_=a("".replace),$=a("".slice),k=Math.max,y=function(t,e,i){return i>t.length?-1:""===e?i:b(t,e,i)};s({target:"String",proto:!0},{replaceAll:function(t,e){var i,s,a,m,A,S,P,x,q,O=r(this),D=0,w=0,E="";if(!l(t)){if((i=c(t))&&(s=d(r(h(t))),!~b(s,"g")))throw v("`.replaceAll` does not allow non-global regexes");if(a=u(t,f))return n(a,t,O,e);if(g&&i)return _(d(O),t,e)}for(m=d(O),A=d(t),(S=o(e))||(e=d(e)),P=A.length,x=k(1,P),D=y(m,A,0);-1!==D;)q=S?d(e(A,D,m)):p(A,m,D,[],void 0,e),E+=$(m,w,D)+q,w=D+P,D=y(m,A,D+x);return w<m.length&&(E+=$(m,w)),E}})},346:function(t,e,i){var s=i(14),n=i(22),a=i(32)("match");t.exports=function(t){var e;return s(t)&&(void 0!==(e=t[a])?!!e:"RegExp"==n(t))}},347:function(t,e,i){var s=i(31),n=i(13),a=i(57),r=i(348),o=RegExp.prototype;t.exports=function(t){var e=t.flags;return void 0!==e||"flags"in o||n(t,"flags")||!a(o,t)?e:s(r,t)}},348:function(t,e,i){"use strict";var s=i(35);t.exports=function(){var t=s(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e}},349:function(t,e,i){var s=i(7),n=i(34),a=Math.floor,r=s("".charAt),o=s("".replace),l=s("".slice),c=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,d=/\$([$&'`]|\d{1,2})/g;t.exports=function(t,e,i,s,u,h){var p=i+t.length,m=s.length,g=d;return void 0!==u&&(u=n(u),g=c),o(h,g,(function(n,o){var c;switch(r(o,0)){case"$":return"$";case"&":return t;case"`":return l(e,0,i);case"'":return l(e,p);case"<":c=u[l(o,1,-1)];break;default:var d=+o;if(0===d)return n;if(d>m){var h=a(d/10);return 0===h?n:h<=m?void 0===s[h-1]?r(o,1):s[h-1]+r(o,1):n}c=s[d-1]}return void 0===c?"":c}))}},389:function(t,e,i){},457:function(t,e,i){"use strict";i(389)},535:function(t,e,i){"use strict";i.r(e);i(20),i(345),i(21);var s=i(110),n=i(288),a=i(284),o=i(388),l={name:"ListTable",data:()=>({items:[],loading:!0,selection:[],selectAll:!1,options:{},httpPaginator:{},searchString:"",loadingSearch:!1,noPagination:!1,dragOrderingActive:!1}),props:{crud:{type:Object,required:!0},serverPagination:Boolean,navigable:Boolean,lookup:{type:String,default:"id"},detailLink:{type:Function,default(t){return{path:`${this.$route.path}/${t[this.lookup]}`}}},filters:{type:Array,default:()=>[]},searchable:{type:Boolean,default:!1},data:{type:Array,required:!1},dragReorder:{type:Boolean,default:!1}},directives:{sortableDataTable:{bind(t,e,i){const s={animation:150,handle:".handle-drag",onUpdate:function(t){i.child.$emit("sorted",t)}};o.default.create(t.getElementsByTagName("tbody")[0],s)}}},watch:{selection(t){this.$emit("input",t)},selectAll(t){this.$emit("input",t?"all":this.selection)},dragOrderingActive(t){t&&(this.searchString="",this.options={...this.options,sortBy:[]}),this.$emit("drag-order-change",t)},filters:{deep:!0,handler(){this.serverPaginationEnabled&&this.getDataFromApi()}},options:{deep:!0,handler(t){this.noPagination=-1===t.itemsPerPage,this.setQparams(t),this.serverPaginationEnabled&&this.getDataFromApi(!1)}},noPagination(){this.getDataFromApi()},data:{deep:!0,handler(t){t&&(this.items=t)}}},methods:{nameSpacedSlots:a.nameSpacedSlots,getPointed:s.getPointed,getDataFromApi(t=!0){t&&(this.selection=[],this.selectAll=!1),this.loading=!this.offlineMode,!this.offlineMode&&this.debouncedDataFromApi()},debouncedDataFromApi:Object(n.debounce)((function(){return new Promise((t,e)=>{if(this.selection=[],this.serverPaginationEnabled){const i=this.getHttpParams();this.crud.list({params:i}).then(e=>{this.items=e.items,this.httpPaginator=e.paginator,this.loading=!1,t(e)}).catch(t=>e(t))}else this.crud.list().then(e=>{this.items=e,this.loading=!1,this.httpPaginator={},t(e)}).catch(t=>e(t))})}),500),changeOrder(t){this.offlineMode||this.crud.update_order(this.items[t.oldIndex][this.lookup],this.items[t.newIndex][this.lookup]).then(t=>t.reordered&&this.getDataFromApi()).catch(t=>{var e,i;this.getDataFromApi(),this.$mapo.$snack.open({message:(null===(e=t.response)||void 0===e||null===(i=e.data)||void 0===i?void 0:i.detail)||this.$t("mapo.listTable.errorOrder"),color:"error"})});const e=this.items[t.oldIndex];this.items.splice(t.oldIndex,1),this.items.splice(t.newIndex,0,e)},setQparams(t){this.$router.push({query:{...this.$route.query,...this.getOrderParams(t)}})},restoreFromQparams(){var t,e;this.options={...this.options,sortBy:(null===(t=this.$route.query.sort)||void 0===t?void 0:t.split(",").map(t=>t.replace(/^-/,"")))||this.options.sortBy||[],sortDesc:(null===(e=this.$route.query.order)||void 0===e?void 0:e.split(",").map(t=>t.startsWith("-")))||this.options.sortDesc||[],itemsPerPage:parseInt(this.$route.query.items)||this.options.itemsPerPage||10,page:parseInt(this.$route.query.page)||this.options.page||1},this.searchString=this.$route.query.search},getOrderParams(t){const{sortBy:e,sortDesc:i,page:s,itemsPerPage:n}=t;return{sort:e.map((t,e)=>(i[e]?"-":"")+t).join(",")||void 0,items:n,page:1!==s?s:void 0}},getHttpParams(){const t=new URLSearchParams;for(const[e,i]of Object.entries(this.getOrderParams(this.options)))void 0!==i&&t.append(e,i);return this.filters.forEach(e=>{const i=[],s=t=>t.replaceAll(".","__");if(e.datepicker){const t=e.active[0].value.split(",");i.push(`${s(e.value)}__gte=${t[0]}`,`${s(e.value)}__lte=${t[1]}`)}else e.active.length>1?i.push(`${s(e.value)}=[${e.active.map(t=>t.value).join(",")}]`):i.push(`${s(e.value)}=${e.active[0].value}`);i.forEach(e=>t.append("fltr",e))}),this.searchString&&this.searchable&&t.append("search",this.searchString),t},quickAction(t){this.$refs.editModal.open(t).then(e=>{if(e)if(this.offlineMode){let i=t?this.items.findIndex(e=>e[this.lookup]===t[this.lookup]):-1,s=!0;-1!==i?this.items.splice(i,1,e):(i=this.items.push(e),s=!1),this.$emit("update:data",this.items,e,i)}else this.getDataFromApi()})},deleteItem(t){const e=t=>{if(this.offlineMode){const e=this.items.findIndex(e=>e[this.lookup]===t[this.lookup]);-1!==e&&(this.items.splice(e,1),this.$emit("update:data",this.items,r,e))}else this.crud.delete(t[this.lookup]).then(this.getDataFromApi)};this.$mapo.$confirm.open({title:this.$t("mapo.delete"),question:this.$t("mapo.confirmDelete"),approveButton:{text:this.$t("mapo.delete"),attrs:{color:"red",text:!0}}}).then(i=>i?e(t):null)},toggleSelectAll(){this.selectAll=!this.selectAll},search:Object(n.debounce)((function(){this.$router.push({query:{...this.$route.query,search:this.searchString||void 0}}),this.serverPaginationEnabled&&this.getDataFromApi(),this.loadingSearch=!1}),1e3),userCan(t){return!this.$mapo.$auth.routeMiddlewares.includes("permissions")||this.$mapo.$auth.user.permissions.includes(t)}},computed:{filteredItems(){return this.filters.reduce((t,e)=>{let i;return i=e.datepicker?(t,e)=>i=>{let n=Object(s.getPointed)(t,e.value,""),a=n&&new Date(n).getTime(),r=i.value.split(",").map((t,e)=>{let i=new Date(t);return i.setDate(i.getDate()+e),i});return a&&a>=r[0]&&a<=r[1]}:(t,e)=>i=>Object(s.getPointed)(t,e.value,"")===i.value,t.filter(t=>e.active.some(i(t,e)))},[...this.items])},firstColName(){return this.$attrs.headers&&this.$attrs.headers.length&&this.$attrs.headers[0].value},headers(){return this.dragOrderingActive?[{sortable:!1,value:"drag-column",width:"64px"},...this.$attrs.headers]:this.$attrs.headers},quickModeEnabled(){return this.nameSpacedSlots(this.$slots,"qedit.body").length||this.nameSpacedSlots(this.$scopedSlots,"qedit.body").length||this.$attrs.editFields&&this.$attrs.editFields.length},serverPaginationEnabled(){return this.serverPagination&&!this.noPagination&&!this.offlineMode},offlineMode(){return!!this.data},serverItemsLength(){return this.httpPaginator.count||this.serverPaginationEnabled&&this.options.page*this.options.itemsPerPage||-1}},mounted(){this.restoreFromQparams(),this.offlineMode?(this.items=this.data,this.loading=!1):this.getDataFromApi()}},c=(i(457),i(1)),d=Object(c.a)(l,(function(){var t=this,e=t._self._c;return e("div",[e("v-data-table",t._b({directives:[{name:"sortable-data-table",rawName:"v-sortable-data-table"}],class:{mapo__listtable__all_selected:t.selectAll},attrs:{headers:t.headers,"show-select":!t.dragOrderingActive&&t.$attrs["show-select"],items:t.serverPaginationEnabled?t.items:t.filteredItems,loading:t.loading,options:t.options,search:t.searchString,"server-items-length":t.serverItemsLength,"item-key":t.lookup,"disable-sort":t.dragOrderingActive},on:{"update:options":function(e){t.options=e},sorted:t.changeOrder},scopedSlots:t._u([{key:"top",fn:function(){return[e("v-toolbar",{attrs:{flat:""}},[t.searchable?e("v-text-field",{staticClass:"search-input rounded-0",attrs:{"prepend-inner-icon":"mdi-magnify",label:t.$t("mapo.search"),"single-line":"","hide-details":"",outlined:"",dense:"",clearable:"",loading:t.loadingSearch},on:{input:function(e){t.loadingSearch=t.serverPaginationEnabled,t.search()}},model:{value:t.searchString,callback:function(e){t.searchString=e},expression:"searchString"}}):t._e(),t._v(" "),e("v-spacer"),t._v(" "),t._t("dtable.top.center"),t._v(" "),e("v-spacer"),t._v(" "),t.quickModeEnabled&&t.userCan("add")?e("v-btn",{staticClass:"ml-2",attrs:{text:""},on:{click:function(e){return t.quickAction()}}},[e("v-icon",{staticClass:"d-none d-sm-block mr-2",attrs:{small:"",left:""}},[t._v(" mdi-plus ")]),t._v(" "),e("span",{staticClass:"d-none d-sm-block"},[t._v(t._s(t.$t("mapo.listTable.quickAdd")))])],1):t._e(),t._v(" "),t.serverPaginationEnabled?e("v-btn",{staticClass:"mx-sm-2 ma-2 mx-0",attrs:{icon:""},on:{click:function(e){return t.getDataFromApi(!1)}}},[e("v-icon",[t._v("mdi-update")])],1):t._e()],2),t._v(" "),t._t("dtable.top.under")]},proxy:!0},t.dragReorder?{key:"footer.prepend",fn:function(){return[e("v-tooltip",{attrs:{right:""},scopedSlots:t._u([{key:"activator",fn:function({on:i,attrs:s}){return[e("v-btn",t._g(t._b({class:{"primary--text":t.dragOrderingActive},staticStyle:{"margin-left":"2px"},attrs:{icon:""},on:{click:function(e){t.dragOrderingActive=!t.dragOrderingActive}}},"v-btn",s,!1),i),[e("v-icon",[t._v("mdi-order-bool-ascending")])],1)]}}],null,!1,3969334591)},[t._v(" "),e("span",[t._v(t._s(t.$t("mapo.listTable.toggleOrder")))])])]},proxy:!0}:null,t.navigable?{key:"item."+t.firstColName,fn:function({item:i}){return[e("NuxtLink",{attrs:{to:t.detailLink(i)}},[t._v("\n        "+t._s(t.getPointed(i,t.firstColName,"")||"Unknown")+"\n      ")])]}}:null,t.selectAll?{key:"item.data-table-select",fn:function({isSelected:i,select:s}){return[e("v-simple-checkbox",{on:{input:s},model:{value:t.selectAll,callback:function(e){t.selectAll=e},expression:"selectAll"}})]}}:null,t.selectAll?{key:"header.data-table-select",fn:function({on:i,props:s}){return[e("v-simple-checkbox",{on:{input:i.input},model:{value:t.selectAll,callback:function(e){t.selectAll=e},expression:"selectAll"}})]}}:null,{key:"item.actions",fn:function({item:i}){return[t.quickModeEnabled?e("v-icon",{staticClass:"mr-2",attrs:{disabled:!t.userCan("change"),small:""},on:{click:function(e){return t.quickAction(i)}}},[t._v("\n        mdi-pencil\n      ")]):t._e(),t._v(" "),e("v-icon",{attrs:{disabled:!t.userCan("delete"),small:""},on:{click:function(e){return t.deleteItem(i)}}},[t._v(" mdi-delete ")])]}},{key:"item.drag-column",fn:function(){return[e("v-icon",{staticClass:"handle-drag"},[t._v("mdi-drag")])]},proxy:!0},t._l(t.nameSpacedSlots(t.$scopedSlots,"dtable."),(function(e){return{key:e,fn:function(i){return[t._t("dtable."+e,null,null,i)]}}}))],null,!0),model:{value:t.selection,callback:function(e){t.selection=e},expression:"selection"}},"v-data-table",t.$attrs,!1),[t._v(" "),t._v(" "),t._v(" "),t._v(" "),t._v(" "),t._v(" "),t._v(" "),t._l(t.nameSpacedSlots(t.$slots,"dtable."),(function(i){return e("template",{slot:i},[t._t("dtable."+i)],2)}))],2),t._v(" "),t.quickModeEnabled?e("list-quick-edit",t._b({ref:"editModal",attrs:{offline:t.offlineMode},scopedSlots:t._u([t._l(t.nameSpacedSlots(t.$scopedSlots,"qedit."),(function(e){return{key:e,fn:function(i){return[t._t("qedit."+e,null,null,i)]}}}))],null,!0)},"list-quick-edit",{...t.$attrs,value:!1,crud:t.crud,lookup:t.lookup},!1),[t._l(t.nameSpacedSlots(t.$slots,"qedit."),(function(i){return e("template",{slot:i},[t._t("qedit."+i)],2)}))],2):t._e()],1)}),[],!1,null,"6189d55c",null);e.default=d.exports}}]);